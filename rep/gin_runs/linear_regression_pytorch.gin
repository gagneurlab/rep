import rep.models
import rep.datasets
import rep.metrics
import rep.trainer
import torch
import torch.nn
# ==================================================================
# model.gin
# --------------------------------------------
# model
train.trainer_cls = @PyTorchTrainer
train.model = @torch_linear_model()
torch_linear_model.input_dim = 19932
torch_linear_model.output_dim = 19932
torch_linear_model.criterion = @MSELoss()
MSELoss.size_average = True
torch_linear_model.optimiser = @Adam
torch_linear_model.l_rate = 0.001

# --------------------------------------------
# training
train.batch_size = 200
train.num_workers = 8

# train-specific
train.epochs = 10
# train.early_stop_patience = 4
# train.train_epoch_frac = 1.0  # optionally subset the training set
# train.valid_epoch_frac = 1.0  # optionally subset the validation set


# ==================================================================
# problem.gin
# --------------------------------------------
# data
train.data = @rep_blood_expression()  # use the default train and valid chromosomes
rep_blood_expression.x_train_h5 = "/s/project/rep/processed/gtex/input_data/X_train_pc_bloodonly.h5"
rep_blood_expression.y_train_h5 = "/s/project/rep/processed/gtex/input_data/Y_train_pc_bloodonly.h5"
rep_blood_expression.x_valid_h5 = "/s/project/rep/processed/gtex/input_data/X_valid_pc_bloodonly.h5"
rep_blood_expression.y_valid_h5 = "/s/project/rep/processed/gtex/input_data/Y_valid_pc_bloodonly.h5"
rep_blood_expression.label = "pc_blood"
rep_blood_expression.metadata_train_file = "/s/project/rep/processed/gtex/input_data/XY_metadata_train_pc_bloodonly.json"
rep_blood_expression.metadata_valid_file = "/s/project/rep/processed/gtex/input_data/XY_metadata_valid_pc_bloodonly.json"

#rep_blood_expression.x_train_h5 = "/s/project/rep/processed/gtex/input_data/xtrain_mock.h5"
#rep_blood_expression.y_train_h5 = "/s/project/rep/processed/gtex/input_data/ytrain_mock.h5"
#rep_blood_expression.x_valid_h5 = "/s/project/rep/processed/gtex/input_data/xvalid_mock.h5"
#rep_blood_expression.y_valid_h5 = "/s/project/rep/processed/gtex/input_data/yvalid_mock.h5"

# --------------------------------------------
# evaluation
train.eval_metric = @rep_metric
train.eval_train = True
